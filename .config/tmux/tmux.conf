#### ENV
set -gF @config_file '#{current_file}'
set -gF @config '#{d:@config_file}'
set -gF @script '#{@config}/.scripts'

run '#{@config}/statusbar'

#### Options
# set -g  default-terminal tmux-256color
set -sa terminal-features "xterm*:extkeys"  # ,xterm-kitty:RGB xterm-256color
set -sa terminal-features ",xterm-256color:extkeys"
# set -ga terminal-overrides ,xterm-256color:Tc  # ,*256col*:Tc
set -g  repeat-time 1000
set -g  mouse on
set -g  extended-keys on
# set -s  extended-keys always
# set -s  extended-keys-format 'csi-u'
set -gw xterm-keys on
set -gs escape-time 50  # Address vim mode switching delay
set -g  display-time 4000
set -g  status-interval 5  # Status refresh rate
set -g  status-position bottom
set -g  history-limit 50000  # Scrollback buffer size
set -g  base-index 1
set -g  pane-base-index 1
set -g  focus-events on
set -gw automatic-rename on
set -gs set-clipboard external
set -g  allow-passthrough on
# set -g  default-shell fish
set -g  message-style 'fg=#EFC9A5,bold'

setw -g mode-keys vi
setw -g renumber-windows on
setw -g aggressive-resize off

set -g  popup-border-style fg='#44415a'
set -g  popup-border-lines rounded

# Undercurl
set -g default-terminal "$TERM"
set -as terminal-overrides ",*-256color:Tc"
# Undercurl support
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm'
# Underscore colors
set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' 

#### Keymaps
unbind C-b; set -g prefix 'C-;' # Terminal emmulator remap `M-|` to `C-;`
bind C-r {
	source -F '#{@config_file}'
	display -d 400 'Configuration Reloaded!'
}

## best keymap ever
bind -n 'M-;' switch-client -T vendetta
bind -T vendetta M-n run 'tmuxizer || true'

# TMUX Harpoon
# bind -T vendetta M-a run '#{@script}/harpoon -a'
# bind -T vendetta M-h run '#{@script}/harpoon -l'
# bind -T vendetta M-e run '#{@script}/harpoon -e'
# bind -n M-U run '#{@script}/harpoon -s 1'
# bind -n M-I run '#{@script}/harpoon -s 2'
# bind -n M-O run '#{@script}/harpoon -s 3'
# bind -n M-P run '#{@script}/harpoon -s 4'


## sessions
bind C-w choose-tree -ZwsK "#{?#{e|<:#{line},9},#{e|+:1,#{line}},#{?#{e|<:#{line},35},M-#{a:#{e|+:97,#{e|-:#{line},9}}},}}"
unbind g

## window (tab)
bind C-n new-window -c "#{pane_current_path}"
bind Q confirm -p 'Kill session?' kill-session
bind -n C-Tab   next-window
bind -n C-S-Tab previous-window
bind -n C-BTab  previous-window

bind C-s {
  if "tmux switch-client -l" \
    { display -d 800 "[INFO] Switched to [[ #{session_name} ]]" } \
    { display -d 600 "#[fg=#FD7CA0][ERROR] Alt Session Not Found!" }
}

# better close
bind C-q {
  if -F "#{e|>:#{window_panes},1}" { kill-pane } {
    if -F "#{e|>:#{session_windows},1}" { kill-window } {
      confirm -p "Kill session?" kill-session
    }
  }
}

bind v { split-window -c "#{pane_current_path}" -h }
bind s { split-window -c "#{pane_current_path}" -v }

# move window
bind -r < { swap-window -t -1; previous-window }
bind -r > { swap-window -t +1; next-window }

## Pane
bind -r k select-pane -U
bind -r j select-pane -D
bind -r h select-pane -L
bind -r l select-pane -R
bind C-k select-pane -U
bind C-j select-pane -D
bind C-h select-pane -L
bind C-l select-pane -R

bind -r S-Up    resize-pane -U
bind -r S-Down  resize-pane -D
bind -r S-Left  resize-pane -L
bind -r S-Right resize-pane -R

## Copy mode
bind C-f copy-mode
bind -T copy-mode-vi C-q    send -X cancel
bind -T copy-mode-vi Escape send -X cancel
bind -T copy-mode-vi q      send -X clear-selection
bind -T copy-mode-vi k      send -X cursor-up
bind -T copy-mode-vi j      send -X cursor-down
bind -T copy-mode-vi h      send -X cursor-left
bind -T copy-mode-vi l      send -X cursor-right
bind -T copy-mode-vi C-k    send -X halfpage-up
bind -T copy-mode-vi C-j    send -X halfpage-down
bind -T copy-mode-vi L      send -X end-of-line
bind -T copy-mode-vi H      send -X start-of-line
bind -T copy-mode-vi y      send -X copy-selection
bind -T copy-mode-vi v      send -X begin-selection
bind -T copy-mode-vi C-v    send -X rectangle-toggle

# disable copy-on-mousse-selection-release
unbind -T copy-mode-vi MouseDragEnd1Pane

## URL Launcher
bind C-o run "tmux popup -h 40% -w 60% -E '#{@script}/open-url'"

## BTOP
bind b popup -T 'BTOP' -h 90% -w 90% -E 'btop.exe'
bind B new-window -c '~' 'btop.exe'


## Toggles
bind C-z set status

## Map special keybindings to ASCII stuffs
# NOTE: Terminal should also send ASCII for these keybindings as well
bind -n C-Enter   send \033'[13;5u'
bind -n C-S-Enter send \033'[13;6u'
bind -n C-S-Space send \033'[32;6u'
bind -n 'C-`'     send \033'[96;5u'
bind -n 'C-.'     send \033'[46;5u'
